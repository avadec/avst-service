
# Testing mode docker-compose override
# Usage: docker compose -f docker-compose.yml -f docker-compose.testing.yml up

services:
  api:
    # Override / extend environment for testing
    # Compose will merge this with the base env and override matching keys
    environment:
      TESTING_MODE: "true"
      ENABLE_STT: "false"
      ENABLE_SUMMARIZATION: "false"
      ENABLE_CALLBACK: "false"

  worker:
    # Override / extend environment for testing
    environment:
      TESTING_MODE: "true"
      ENABLE_STT: "false"
      ENABLE_SUMMARIZATION: "false"
      ENABLE_CALLBACK: "false"

    # Remove GPU reservations from the base compose (no NVIDIA on Mac)
    # This overrides the whole `deploy` block from docker-compose.yml
    deploy: {}

    # Override volumes for local testing (replaces /mnt/audio with local dir)
    volumes:
      - ./test_audio:/mnt/audio:ro
      - whisper-cache:/root/.cache
      - ./testing_output.log:/app/testing_output.log
